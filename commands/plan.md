# /polyglot:plan 命令

将功能描述转换为详细、可执行的实施计划，包含研究和验收标准。

## 用法

```
/polyglot:plan [功能描述或 Issue 引用]
```

## 流程

### 阶段1：研究与发现

1. **代码库分析**
   - 调用 `codebase-researcher` 代理理解当前架构
   - 识别相关现有代码、模式和依赖
   - 映射受影响的系统和组件

2. **框架研究**（如需要）
   - 调用 `framework-researcher` 代理获取技术指导
   - 研究特定任务的最佳实践
   - 识别潜在的库或方法

3. **需求澄清**
   - 解析功能描述
   - 识别歧义
   - 必要时提出澄清问题

### 阶段2：计划生成

1. **范围定义**
   - 定义清晰边界
   - 识别包含和排除项
   - 列出假设

2. **任务分解**
   - 分解为原子化、可估算的任务
   - 识别任务间依赖
   - 逻辑排序任务

3. **技术设计**
   - 定义数据模型/类型
   - 设计 API 契约（如适用）
   - 指定组件交互

4. **验收标准**
   - 为每个任务定义可测试标准
   - 指定预期行为
   - 包含边界情况

### 阶段3：风险评估

1. **技术风险**
   - 识别复杂区域
   - 标注不确定点
   - 建议缓解措施

2. **依赖关系**
   - 外部服务依赖
   - 库版本要求
   - 团队依赖

## 输出格式

```markdown
# 实施计划：[功能名称]

## 概述
简要描述将要实现的内容。

## 研究摘要
代码库和框架研究的关键发现。

## 范围

### 包含
- 项目1
- 项目2

### 排除
- 项目1
- 项目2

### 假设
- 假设1
- 假设2

## 技术设计

### 数据模型
```language
// 类型定义或模型
```

### API 契约（如适用）
| 端点 | 方法 | 描述 |
|------|------|------|
| /api/x | POST | 执行 Y |

### 组件变更
| 组件 | 变更类型 | 描述 |
|------|----------|------|
| file.ts | 修改 | 添加 X |

## 实施任务

### 任务1：[任务标题]
**描述**：需要完成的工作
**文件**：需要变更的文件列表
**验收标准**：
- [ ] 标准1
- [ ] 标准2

### 任务2：[任务标题]
...

## 测试策略
- 单元测试：[列表]
- 集成测试：[列表]
- E2E 测试：[列表]

## 风险与缓解
| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| X | 高 | Y |

## 依赖
- 库 X 版本 Y
- 外部服务 Z

## 备注
实施的其他注意事项。
```

## 使用示例

### 简单功能
```
/polyglot:plan 添加用户头像上传功能
```

### 从 Issue 创建
```
/polyglot:plan #123
```

### 复杂功能
```
/polyglot:plan 实现 WebSocket 实时通知，
支持移动推送和邮件回退
```

## 与其他命令集成

计划完成后：
- 使用 `/polyglot:work` 执行计划
- 实现后使用 `/polyglot:review` 审查
- 使用 `/polyglot:docs` 更新文档

## 最佳实践

1. **从小处着手**：将大功能分解为多个计划
2. **明确具体**：模糊的描述导致模糊的计划
3. **包含上下文**：引用现有代码或模式
4. **执行前审查**：计划应在开始工作前审查
